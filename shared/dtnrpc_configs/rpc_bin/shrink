#!/bin/bash

# The serval instance path needs to be constructed...
SERVALINSTANCE_PATH=$SESSION_DIR/`hostname`.conf

# Get the first parts of the trace: SID, hostname and when the procedure stated.
SID=`servald id self | tail -1`
HOSTNAME=`hostname`
STARTTIME=`date +%s%N`

# Resize the image
mogrify -resize $2 $1

# Measure, how long it took
ENDTIME=`date +%s%N`

# Set the trace as comment of the file. First, get the comment, strip the first
# 8 chars (comment=) and append the trace
comment=$(identify -format '%[comment*]' $1)
comment="${comment:8}$STARTTIME,$SID,$HOSTNAME,$ENDTIME;"

# Set the newly build trace
mogrify -set comment "$comment" $1

# Done
echo $1
exit 0
